<!doctype html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>EzAdmin Upload Generator - 재고 DB 동기화</title>
		<meta name="description" content="패킹리스트 분석 및 이지어드민 업로드 파일 생성기" />
		<link rel="stylesheet" href="style.css" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body>
		<div class="app-container">
			<!-- 헤더 -->
			<header class="app-header">
				<div class="header-content">
					<h1>EzAdmin Upload Generator</h1>
					<div class="header-subtitle">재고 DB 동기화</div>
				</div>
				<div class="progress-indicator">
					<div class="progress-step active" data-step="1">
						<div class="step-number">1</div>
						<div class="step-label">파일 업로드</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="2">
						<div class="step-number">2</div>
						<div class="step-label">분석</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="3">
						<div class="step-number">3</div>
						<div class="step-label">매핑</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="4">
						<div class="step-number">4</div>
						<div class="step-label">완료</div>
					</div>
				</div>
			</header>

			<!-- 탭 메뉴 -->
			<nav class="app-tabs">
				<button class="tab-btn active" data-tab="analysis-tab">
					<span class="tab-icon">🔍</span> 패킹리스트 분석
				</button>
				<button class="tab-btn" data-tab="database-tab">
					<span class="tab-icon">💾</span> 제품 DB 관리
				</button>
			</nav>

			<!-- 메인 컨텐츠 -->
			<main class="main-content">
				<!-- Step 1: 패킹리스트 분석 섹션 -->
				<div id="analysis-tab" class="tab-content active">
					<section id="upload-section" class="section active">
					<div class="section-header top-header">
						<div class="title-group">
							<h2>📦 패킹리스트 업로드</h2>
							<p class="section-description">엑셀 파일 제품 정보 추출</p>
						</div>

						<!-- 도매인 관리 영역 -->
						<div class="wholesaler-section mini">
							<div class="wholesaler-header-row">
								<button id="add-wholesaler-btn" class="btn btn-secondary btn-sm">
									<span class="btn-icon">➕</span>
									새 도매인 등록
								</button>
							</div>

							<!-- 도매인 추가 폼 (숨김) -->
							<div id="wholesaler-form" class="wholesaler-form hidden">
								<div class="input-group">
									<input
										type="text"
										id="new-wholesaler-input"
										class="form-input"
										placeholder="도매인명"
									/>
									<div class="input-actions">
										<button id="save-wholesaler-btn" class="btn btn-primary btn-sm">등록</button>
										<button id="cancel-wholesaler-btn" class="btn btn-ghost btn-sm">취소</button>
									</div>
								</div>
							</div>

							<!-- 등록된 도매인 목록 -->
							<div id="wholesaler-tags" class="wholesaler-tags"></div>
						</div>
					</div>

					<div class="upload-card">
						<!-- 파일 업로드 영역 -->

						<!-- 파일 업로드 영역 -->
						<!-- 파일 업로드 영역 (컴팩트 버전) -->
						<div class="file-upload-area compact" id="file-upload-area">
							<div class="upload-content">
								<span class="upload-icon">📁</span>
								<span class="upload-text"
									>패킹리스트 파일을 여기에 드래그하거나 클릭하세요 (.xlsx, .xls, .csv 가능)</span
								>
							</div>
							<input type="file" id="file-input" accept=".xlsx,.xls,.csv" multiple hidden />
							<button class="btn btn-primary" id="select-file-btn">파일 추가하기</button>
						</div>

						<!-- 분석 버튼 (업로드 영역과 목록 사이) -->
						<div class="action-buttons middle">
							<button id="analyze-btn" class="btn btn-primary" disabled>
								<span class="btn-icon">🔍</span>
								현재 등록된 모든 파일 분석 시작하기
							</button>
						</div>

						<!-- 업로드된 파일 목록 -->
						<div id="file-list-section" class="file-list-section hidden">
							<h3>📂 업로드된 파일 및 시트 설정</h3>
							<p class="helper-text">
								각 파일의 시트별 도매인을 지정하세요 (첫 번째 시트는 자동 제외)
							</p>
							<div id="file-list-container" class="file-list-container">
								<!-- JavaScript에서 파일별 시트 설정 목록이 동적으로 생성됨 -->
							</div>
						</div>

						<!-- 하단 분석 버튼 제거됨 -->
					</div>
				</div>

				<!-- Step 2: 제품 DB 관리 섹션 (신규) -->
				<div id="database-tab" class="tab-content">
					<section class="section active">
						<div class="section-header">
							<div class="title-group">
								<h2>💾 제품 DB 마스터 등록</h2>
								<p class="section-description">이지어드민 '현재고조회' 파일을 업로드하여 기준 DB를 구축합니다.</p>
							</div>
						</div>

						<div class="upload-card">
							<div class="wholesaler-selector-row mb-2">
								<label for="db-wholesaler-select">등록할 도매인 선택:</label>
								<select id="db-wholesaler-select" class="form-select">
									<option value="">-- 도매인 선택 --</option>
								</select>
							</div>

							<div class="file-upload-area compact" id="db-file-upload-area">
								<div class="upload-content">
									<span class="upload-icon">📁</span>
									<span class="upload-text">이지어드민 엑셀 파일을 여기에 드래그하거나 클릭하세요</span>
								</div>
								<input type="file" id="db-file-input" accept=".xlsx,.xls" hidden />
								<button class="btn btn-secondary" id="db-select-file-btn">DB 파일 선택</button>
							</div>

							<div id="db-status-area" class="mt-2 hidden">
								<div class="db-stats-card">
									<div class="stat-item">
										<span class="stat-label">등록된 총 상품 수:</span>
										<span class="stat-value" id="total-db-count">0</span>
									</div>
									<button id="clear-db-btn" class="btn btn-danger btn-sm">DB 초기화</button>
								</div>
							</div>
						</div>
					</section>
				</div>

				<!-- Step 2: 분석 중 섹션 -->
				<section id="analyzing-section" class="section">
					<div class="analyzing-container">
						<div class="loader"></div>
						<h2>패킹리스트 분석 중...</h2>
						<p>제품명, 색상, 사이즈, 수량 정보를 추출하고 있습니다</p>
						<div class="progress-bar">
							<div class="progress-bar-fill" id="progress-bar-fill"></div>
						</div>
						<div class="progress-text" id="progress-text">0%</div>
					</div>
				</section>

				<!-- Step 3: 분석 결과 섹션 -->
				<section id="results-section" class="section">
					<div class="section-header">
						<h2>✅ 분석 완료</h2>
						<p class="section-description">추출된 제품 정보를 확인하세요</p>
					</div>

					<div class="results-card">
						<div class="results-summary">
							<div class="summary-item">
								<div class="summary-label">분석된 제품</div>
								<div class="summary-value" id="total-products">0</div>
							</div>
							<div class="summary-item">
								<div class="summary-label">도매인</div>
								<div class="summary-value" id="selected-wholesaler">-</div>
							</div>
							<div class="summary-item">
								<div class="summary-label">총 수량</div>
								<div class="summary-value" id="total-quantity">0</div>
							</div>
						</div>

						<!-- 추출된 데이터 테이블 -->
						<div class="table-container">
							<table class="data-table">
								<thead>
									<tr>
										<th>번호</th>
										<th>도매인</th>
										<th>파일명</th>
										<th>시트</th>
										<th>제품명</th>
										<th>색상</th>
										<th>사이즈</th>
										<th>수량</th>
									</tr>
								</thead>
								<tbody id="results-table-body">
									<!-- 동적으로 생성됨 -->
								</tbody>
							</table>
						</div>

						<div class="action-buttons">
							<button id="download-excel-btn" class="btn btn-secondary">
								<span class="btn-icon">�</span>
								엑셀 다운로드
							</button>
							<button id="restart-btn" class="btn btn-secondary">
								<span class="btn-icon">🔄</span>
								새로 시작
							</button>
							<button id="next-step-btn" class="btn btn-primary btn-large">
								<span class="btn-icon">➡️</span>
								다음 단계 (매핑)
							</button>
						</div>
					</div>
				</section>
			</main>

			<!-- 토스트 알림 -->
			<div id="toast-container" class="toast-container"></div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<script src="app.js"></script>
	</body>
</html>
