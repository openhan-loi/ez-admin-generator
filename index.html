<!doctype html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>EzAdmin Upload Generator - 재고 DB 동기화</title>
		<meta name="description" content="패킹리스트 분석 및 이지어드민 업로드 파일 생성기" />
		<link rel="stylesheet" href="style.css" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
			rel="stylesheet"
		/>
	</head>
	<body>
		<div class="app-container">
			<!-- 헤더 -->
			<header class="app-header">
				<div class="header-content">
					<h1>EzAdmin Upload Generator</h1>
					<div class="header-subtitle">재고 DB 동기화</div>
				</div>
				<div class="progress-indicator">
					<div class="progress-step active" data-step="1">
						<div class="step-number">1</div>
						<div class="step-label">파일 업로드</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="2">
						<div class="step-number">2</div>
						<div class="step-label">분석</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="3">
						<div class="step-number">3</div>
						<div class="step-label">매핑</div>
					</div>
					<div class="progress-line"></div>
					<div class="progress-step" data-step="4">
						<div class="step-number">4</div>
						<div class="step-label">완료</div>
					</div>
				</div>
			</header>

			<!-- 탭 메뉴 -->
			<nav class="app-tabs">
				<button class="tab-btn active" data-tab="analysis-tab">
					<span class="tab-icon">🔍</span> 패킹리스트 분석
				</button>
				<button class="tab-btn" data-tab="database-tab">
					<span class="tab-icon">💾</span> 제품 DB 관리
				</button>
				<button class="tab-btn" data-tab="mapping-tab">
					<span class="tab-icon">🔗</span> 매핑 및 검토
				</button>
				<button class="tab-btn" data-tab="complete-tab">
					<span class="tab-icon">✅</span> 생성 완료
				</button>
			</nav>

			<!-- 분석 버튼 및 매핑 버튼 (플로팅 버튼 컨테이너 - 최상위로 이동) -->
			<div class="action-buttons middle">
				<button id="analyze-btn" class="btn btn-primary" disabled>
					<span class="btn-icon">🔍</span>
					분석 시작하기
				</button>
				<button id="next-step-btn" class="btn btn-primary hidden">
					<span class="btn-icon">➡️</span>
					다음 단계 (매핑)
				</button>
				<button id="start-auto-mapping-btn" class="btn btn-primary hidden">
					<span class="btn-icon">🤖</span>
					자동 매핑 시작
				</button>
			</div>

			<!-- 메인 컨텐츠 영역 (레이아웃 분리) -->
			<div class="app-main-layout">
				<main class="main-content">
				<!-- Step 1: 패킹리스트 분석 섹션 -->
				<div id="analysis-tab" class="tab-content active">
					<div class="section-header top-header">
						<div class="title-group">
							<h2>📦 패킹리스트 업로드</h2>
							<p class="section-description">엑셀 파일 제품 정보 추출</p>
						</div>

						<!-- 도매인 관리 영역 -->
						<div class="wholesaler-section mini">
							<div class="wholesaler-header-row">
								<button class="btn btn-ghost btn-sm" id="clear-all-files">
									<span class="btn-icon">🗑️</span>
									전체 삭제
								</button>
								<button class="btn btn-primary btn-sm" id="select-file-btn">
									<span class="btn-icon">📁</span>
									파일 추가하기
								</button>
								<button id="add-wholesaler-btn" class="btn btn-secondary btn-sm">
									<span class="btn-icon">➕</span>
									새 도매인 등록
								</button>
							</div>

							<!-- 도매인 추가 폼 (숨김) -->
							<div id="wholesaler-form" class="wholesaler-form hidden">
								<div class="input-group">
									<input
										type="text"
										id="new-wholesaler-input"
										class="form-input"
										placeholder="도매인명"
									/>
									<div class="input-actions">
										<button id="save-wholesaler-btn" class="btn btn-primary btn-sm">등록</button>
										<button id="cancel-wholesaler-btn" class="btn btn-ghost btn-sm">취소</button>
									</div>
								</div>
							</div>

							<!-- 등록된 도매인 목록 -->
							<div id="wholesaler-tags" class="wholesaler-tags"></div>
						</div>
					</div>

					<section id="upload-section" class="section active">
						<div class="upload-card">
						<!-- 파일 업로드 영역 -->

						<!-- 파일 업로드 영역 -->
						<!-- 파일 업로드 영역 (컴팩트 버전) -->
						<div class="file-upload-area compact" id="file-upload-area">
							<div class="upload-content">
								<span class="upload-icon">📁</span>
								<span class="upload-text">패킹리스트 파일을 여기에 드래그하세요</span>
							</div>
							<input type="file" id="file-input" accept=".xlsx,.xls,.csv" multiple hidden />
						</div>

						<!-- 업로드된 파일 목록 -->
						<div id="file-list-section" class="file-list-section hidden">
							<h3>📂 업로드된 파일 및 시트 설정</h3>
							<p class="helper-text">
								각 파일의 시트별 도매인을 지정하세요 (첫 번째 시트는 자동 제외)
							</p>
							<div id="file-list-container" class="file-list-container">
								<!-- JavaScript에서 파일별 시트 설정 목록이 동적으로 생성됨 -->
							</div>
						</div>
					</section>

					<!-- 분석 중 섹션 (탭 내부) -->
					<section id="analyzing-section" class="section">
						<div class="analyzing-container">
							<div class="loader"></div>
							<h2>패킹리스트 분석 중...</h2>
							<p>제품명, 색상, 사이즈, 수량 정보를 추출하고 있습니다</p>
							<div class="progress-bar">
								<div class="progress-bar-fill" id="progress-bar-fill"></div>
							</div>
							<div class="progress-text" id="progress-text">0%</div>
						</div>
					</section>

					<!-- 분석 결과 섹션 (탭 내부로 이동) -->
					<section id="results-section" class="section">
						<div class="section-header">
							<h2>✅ 분석 완료</h2>
							<p class="section-description">추출된 제품 정보를 확인하세요</p>
						</div>

						<div class="results-card">
							<div class="results-summary">
								<div class="summary-item">
									<div class="summary-label">분석된 제품</div>
									<div class="summary-value" id="total-products">0</div>
								</div>
								<div class="summary-item">
									<div class="summary-label">도매인</div>
									<div class="summary-value" id="selected-wholesaler">-</div>
								</div>
								<div class="summary-item">
									<div class="summary-label">총 수량</div>
									<div class="summary-value" id="total-quantity">0</div>
								</div>
							</div>

							<!-- 추출된 데이터 테이블 -->
							<div class="table-container">
								<table class="data-table">
									<thead>
										<tr>
											<th>번호</th>
											<th>도매인</th>
											<th>파일명</th>
											<th>시트</th>
											<th>제품명</th>
											<th>색상</th>
											<th>사이즈</th>
											<th>수량</th>
										</tr>
									</thead>
									<tbody id="results-table-body">
										<!-- 동적으로 생성됨 -->
									</tbody>
								</table>
							</div>

							<div class="action-buttons flex-center mt-3">
								<button id="download-excel-btn" class="btn btn-secondary">
									<span class="btn-icon">📥</span>
									분석결과 엑셀 다운로드
								</button>
								<button id="restart-btn" class="btn btn-secondary">
									<span class="btn-icon">🔄</span>
									새로 시작
								</button>
							</div>
						</div>
					</section>
				</div>

				<!-- Step 2: 제품 DB 관리 섹션 (신규) -->
				<div id="database-tab" class="tab-content">
					<section class="section active">
						<div class="section-header">
							<div class="title-group">
								<h2>💾 제품 DB 마스터 등록</h2>
								<p class="section-description">이지어드민 '현재고조회' 파일을 업로드하여 기준 DB를 구축합니다.</p>
							</div>
						</div>

						<div class="upload-card">
							<div class="wholesaler-selector-row mb-2">
								<label for="db-wholesaler-select">등록할 도매인 선택:</label>
								<select id="db-wholesaler-select" class="form-select">
									<option value="">-- 도매인 선택 --</option>
								</select>
							</div>

							<div class="file-upload-area compact" id="db-file-upload-area">
								<div class="upload-content">
									<span class="upload-icon">📁</span>
									<span class="upload-text">이지어드민 엑셀 파일을 여기에 드래그하거나 클릭하세요</span>
								</div>
								<input type="file" id="db-file-input" accept=".xlsx,.xls" hidden />
								<button class="btn btn-secondary" id="db-select-file-btn">DB 파일 선택</button>
							</div>

							<div id="db-status-area" class="mt-2 hidden">
								<div class="db-stats-card">
									<div class="stat-item">
										<span class="stat-label">등록된 총 상품 수:</span>
										<span class="stat-value" id="total-db-count">0</span>
									</div>
									<button id="clear-db-btn" class="btn btn-danger btn-sm">DB 초기화</button>
								</div>
							</div>
						</div>
					</section>
				</div>

				<!-- Step 3: 매핑 및 검토 섹션 (신규) -->
				<div id="mapping-tab" class="tab-content">
					<section class="section active">
						<div class="section-header">
							<div class="title-group">
								<h2>🔗 분석 결과 매핑</h2>
								<p class="section-description">분석된 패킹리스트 데이터와 제품 DB를 연결합니다.</p>
							</div>
							<div class="header-actions">
								<button id="clear-mapping-data-btn" class="btn btn-ghost btn-sm" style="color:var(--color-danger); margin-right:8px;">
									<span class="btn-icon">🗑️</span> 매핑 데이터 초기화
								</button>
								<button id="download-mapping-debug-btn" class="btn btn-secondary">
									<span class="btn-icon">🐞</span> 디버그 다운로드
								</button>
							</div>
						</div>

						<div id="mapping-summary-card" class="mapping-summary hidden">
							<div class="mapping-stat success">
								<span class="label">자동 매칭</span>
								<span class="value" id="auto-match-count">0</span>
							</div>
							<div class="mapping-stat warning">
								<span class="label">검토 필요</span>
								<span class="value" id="review-match-count">0</span>
							</div>
							<div class="mapping-stat danger">
								<span class="label">매칭 실패</span>
								<span class="value" id="fail-match-count">0</span>
							</div>
						</div>

						<div class="results-container mt-2">
							<div class="table-responsive">
								<table class="data-table">
									<thead>
										<tr>
											<th>상태</th>
											<th>도매인</th>
											<th>패킹리스트 상품/컬러</th>
											<th>매핑된 DB 정보</th>
											<th>수량</th>
											<th>작업</th>
										</tr>
									</thead>
									<tbody id="mapping-table-body">
										<tr>
											<td colspan="6" class="text-center">분석을 먼저 완료해주세요.</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>

						<!-- 4단계 진입 버튼 -->
						<div class="action-buttons flex-center mt-3 py-3" style="border-top: 1px solid var(--color-border);">
							<button id="generate-ezauto-btn" class="btn btn-primary btn-lg" style="padding: 1rem 3rem; font-size: 1.1rem; box-shadow: var(--shadow-glow);">
								<span class="btn-icon">📦</span>
								이지어드민 업로드 파일 생성
							</button>
						</div>
					</section>
				</div>

				<!-- Step 4: 생성 완료 섹션 -->
				<div id="complete-tab" class="tab-content">
					<section class="section active">
						<div class="section-header">
							<div class="title-group">
								<h2>✅ 작업 완료</h2>
								<p class="section-description">이지어드민 업로드 양식에 맞춘 엑셀 파일 생성이 완료되었습니다.</p>
							</div>
						</div>

						<div class="upload-card">
							<div class="complete-status-area text-center py-4">
								<div class="success-icon-large">🎉</div>
								<h2 class="mt-2" style="font-size: var(--font-size-2xl); color: var(--color-primary);">성공적으로 생성되었습니다!</h2>
								<div class="mt-1" id="complete-summary-text" style="color: var(--color-text-secondary); max-width: 500px; margin-left: auto; margin-right: auto;">
									도매인별 업로드용 엑셀 파일이 자동 다운로드되었습니다.
								</div>
							</div>

							<!-- 수량 요약 요약 UI 추가 -->
							<div id="complete-stats-summary" class="complete-stats-grid">
								<!-- 스크립트에서 동적 생성 -->
							</div>

							<div class="download-history-card">
								<h3>📥 생성된 파일 목록</h3>
								<div id="generated-files-list" class="mt-1">
									<!-- 동적으로 생성됨 -->
								</div>
							</div>

							<div class="action-buttons flex-center mt-4 pt-4" style="border-top: 1px solid var(--color-border);">
								<button onclick="location.reload()" class="btn btn-secondary btn-lg" style="padding: 0.8rem 2.8rem;">
									<span class="btn-icon">🔄</span> 처음으로 돌아가기
								</button>
							</div>
						</div>
					</section>
				</div>


			</main>

			<!-- 수동 매칭 모달 -->
			<div id="search-modal" class="modal hidden">
				<div class="modal-content">
					<div class="modal-header">
						<h3>🔍 수동 제품 매칭</h3>
						<button class="close-modal" id="close-search-modal">×</button>
					</div>
					<div class="modal-body">
						<div class="search-input-group">
							<input type="text" id="manual-search-input" class="form-input" placeholder="키워드를 입력하거나 왼쪽 텍스트를 클릭하세요" style="flex:1;" />
							<button id="clear-search-btn" class="btn btn-ghost">비우기</button>
							<button id="execute-search-btn" class="btn btn-primary">검색</button>
							<button id="reuse-query-btn" class="btn btn-secondary">최근 검색어</button>
							<button id="modal-ignore-btn" class="btn btn-danger">매핑 제외</button>
						</div>
						<div class="search-results-area">
							<table class="data-table compact">
								<thead>
									<tr>
										<th>코드</th>
										<th>상품명</th>
										<th>옵션</th>
										<th>선택</th>
									</tr>
								</thead>
								<tbody id="search-results-body">
									<tr><td colspan="4" class="text-center">키워드를 입력하여 검색해주세요.</td></tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

			<!-- 우측 매핑 라이버 피드 사이드바 (신규) -->
			<aside class="mapping-live-sidebar">
				<div class="sidebar-header">
					<h3>🛰️ 실시간 매핑 피드</h3>
					<span class="live-status">Live</span>
				</div>
				<div id="mapping-feed-list" class="feed-list">
					<div class="feed-empty">매핑 활동이 없습니다.</div>
				</div>
				<div class="sidebar-footer">
					<p>과거 매핑 기억이 자동으로 학습됩니다.</p>
				</div>
			</aside>
		</div>

		<!-- 수동 매칭 모달 -->
			<div id="toast-container" class="toast-container"></div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<script src="app.js"></script>
	</body>
</html>
